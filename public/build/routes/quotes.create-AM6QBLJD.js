import{a as W}from"/build/_shared/chunk-XPUKSWXU.js";import{a as X}from"/build/_shared/chunk-7MZJJH37.js";import{b as I}from"/build/_shared/chunk-LWBMBOK4.js";import{b as K,c as E,d as j,e as y,f as v}from"/build/_shared/chunk-4P2AEKIR.js";import{a as et,b as J}from"/build/_shared/chunk-BRYEQANA.js";import{a as G,e as z,f as H}from"/build/_shared/chunk-IHFEL2CD.js";import{J as A,a as U,y as B}from"/build/_shared/chunk-XTGBAL5E.js";import{e as b}from"/build/_shared/chunk-ADMCF34Z.js";var Z=b(et());var n=b(U());var d=b(U());var s=b(A()),rt=({rowId:c,products:C,productSelectValues:$,dispatchPSV:q})=>{let[_,V]=(0,d.useState)(1),[e,P]=(0,d.useState)(0),[x,N]=(0,d.useState)(0),[i,h]=(0,d.useState)("");(0,d.useEffect)(()=>{N(Number(e*_))},[_,e]),(0,d.useEffect)(()=>{let o=$.find(l=>l.row_id===c);o&&(h(o.product_id),V(o.qty),P(o.price))},[$,c]);let S=(o,l)=>{let f=C.find(m=>parseInt(l)===m.product_id);q({type:"update",row_id:o,product_id:l,qty:1,price:f?f.price:0})},g=(o,l)=>{q({type:"update",row_id:o,qty:l})};return(0,s.jsxs)("tr",{className:y,children:[(0,s.jsx)("td",{colSpan:i?1:4,"data-label":"Product",className:v,children:(0,s.jsxs)("select",{className:j,name:`p_${c}_id`,id:`p_${c}_id`,value:i,onChange:o=>{S(c,o.target.value)},children:[(0,s.jsx)("option",{disabled:!0,value:"",children:"Select a product..."}),C.map(({product_id:o,brand_name:l,type_name:f,model_name:m})=>(0,s.jsxs)("option",{value:o,children:[l," - ",f," - ",m]},o)),(0,s.jsx)("option",{value:"-1",children:"Add new product +"})]})}),i&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("td",{"data-label":"Quantity",className:v,children:(0,s.jsx)("input",{className:E,name:`p_${c}_qty`,id:`p_${c}_qty`,type:"number",min:"1",value:_,onChange:o=>{g(c,parseInt(o.target.value))}})}),(0,s.jsx)("td",{"data-label":"Unit (\xA3)",className:`${v} md:text-right`,children:e||" - "}),(0,s.jsx)("td",{"data-label":"Subtotal (\xA3)",className:`${v} md:text-right`,children:x||" - "})]})]})},Y=rt;var t=b(A()),ot=()=>[{title:`${J} - Create quote`}];function tt(){var R,k,L;let c=B(),{customers:C,products:$,brands:q,types:_,models:V}=z(),e=H(),[P,x]=(0,n.useState)(!1),[N,i]=(0,n.useState)(""),[h,S]=(0,n.useState)(1),[g,o]=(0,n.useState)(0),[l,f]=(0,n.useState)(0),[m,T]=(0,n.useState)(0),[F,Q]=(0,n.useState)(!1),[M,w]=(0,n.useReducer)((r,a)=>{let{type:D,...u}=a;switch(D){case"update":return u.product_id==="-1"?(T(u.row_id),Q(!0)):(T(0),Q(!1)),r.map(p=>p.row_id===u.row_id?{...p,...u}:{...p});case"add":return Boolean(r.find(p=>p.row_id===u.row_id))?r:[...r,{...u}];case"remove":return r.filter(p=>p.row_id!==u.row_id);default:return r}},[{row_id:"1",product_id:"",qty:1,price:0}]);return(0,n.useEffect)(()=>{f(M.reduce((r,a)=>r+a.price*a.qty,0)+g)},[M,g]),(0,n.useEffect)(()=>{x(N==="-1")},[N]),(0,n.useEffect)(()=>{e&&(e.createdCustomer&&i(`${e.createdCustomer.customer_id}`),e.createdProduct&&w({type:"update",row_id:m,product_id:`${e.createdProduct.product_id}`}))},[e,m]),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"mb-4 text-center",children:"Create a new quote"}),(0,t.jsxs)(G,{method:"post",className:K,children:[((R=e==null?void 0:e.quoteActionErrors)==null?void 0:R.info)&&(0,t.jsx)("label",{className:"label",children:(0,t.jsx)("span",{className:"label-text-alt text-error",children:e.quoteActionErrors.info})}),(0,t.jsx)("input",{type:"hidden",name:"prodcount",id:"prodcount",value:h}),(0,t.jsx)("fieldset",{disabled:c.state==="submitting",children:(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"label",htmlFor:"customer",children:(0,t.jsx)("span",{className:"label-text",children:"Customer"})}),(0,t.jsxs)("select",{className:j,name:"customer",id:"customer",value:N,onChange:r=>{i(r.target.value)},children:[(0,t.jsx)("option",{disabled:!0,value:"",children:"Select a customer..."}),C.map(({customer_id:r,name:a,tel:D,email:u,address:O})=>(0,t.jsxs)("option",{value:r,children:[a," - ",D," - ",u," - ",O]},r)),(0,t.jsx)("option",{value:"-1",children:"Add new customer +"})]}),((k=e==null?void 0:e.quoteActionErrors)==null?void 0:k.customer)&&(0,t.jsx)("label",{className:"label",children:(0,t.jsx)("span",{className:"label-text-alt text-error",children:e.quoteActionErrors.customer})})]})}),(0,t.jsxs)("fieldset",{disabled:c.state==="submitting",children:[(0,t.jsx)("label",{className:"label",children:(0,t.jsx)("span",{className:"label-text",children:"Products"})}),((L=e==null?void 0:e.quoteActionErrors)==null?void 0:L.product)&&(0,t.jsx)("label",{className:"label",children:(0,t.jsx)("span",{className:"label-text-alt text-error",children:e.quoteActionErrors.product})}),(0,t.jsxs)("table",{className:"table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"hidden md:table-row",children:[(0,t.jsx)("th",{children:"Product"}),(0,t.jsx)("th",{className:"w-[100px]",children:"Quantity"}),(0,t.jsx)("th",{className:"text-right w-[150px]",children:"Unit (\xA3)"}),(0,t.jsx)("th",{className:"text-right w-[150px]",children:"Subtotal (\xA3)"})]})}),(0,t.jsxs)("tbody",{children:[[...Array(h)].map((r,a)=>(0,t.jsx)(Y,{rowId:`${a+1}`,products:$,productSelectValues:M,dispatchPSV:w},a)),(0,t.jsx)("tr",{className:y,children:(0,t.jsx)("td",{colSpan:4,children:(0,t.jsxs)("div",{className:"flex md:justify-end join",children:[(0,t.jsx)("button",{className:"btn join-item",disabled:h===1,onClick:r=>{r.preventDefault(),S(a=>(w({type:"remove",row_id:`${a}`}),a-1))},children:"-"}),(0,t.jsx)("button",{className:"btn join-item",onClick:r=>{r.preventDefault(),S(a=>(w({type:"add",row_id:`${a+1}`,product_id:"",qty:1,price:0}),a+1))},children:"+"})]})})}),(0,t.jsxs)("tr",{className:y,children:[(0,t.jsx)("td",{colSpan:2,className:"hidden md:table-cell"}),(0,t.jsx)("td",{className:"flex md:table-cell",children:(0,t.jsx)("label",{className:"label md:justify-end",htmlFor:"labour",children:(0,t.jsx)("span",{className:"label-text",children:"Labour cost (\xA3):"})})}),(0,t.jsx)("td",{children:(0,t.jsx)("input",{type:"number",min:"0",name:"labour",id:"labour",value:g,className:`${E} md:text-right`,onChange:r=>{o(parseInt(r.target.value))}})})]}),(0,t.jsxs)("tr",{className:y,children:[(0,t.jsx)("td",{colSpan:2,className:"hidden md:table-cell"}),(0,t.jsx)("td",{children:(0,t.jsx)("label",{className:"label md:justify-end",children:(0,t.jsx)("span",{className:"label-text",children:"Total cost (\xA3):"})})}),(0,t.jsx)("td",{children:(0,t.jsx)("label",{className:"label md:justify-end",children:(0,t.jsx)("span",{className:"label-text",children:l})})})]})]})]}),(0,t.jsxs)("div",{className:"flex md:justify-end mt-4 mb-2",children:[(0,t.jsx)("button",{className:"btn",type:"submit",name:"_action",value:"create_quote",children:c.state==="submitting"?"Submitting...":"Submit"}),(0,t.jsx)("a",{className:"btn ml-4",href:"/quotes",children:"Cancel"})]})]})]}),(0,t.jsxs)(I,{open:P,children:[(0,t.jsx)("h3",{className:"mb-4",children:"Create new customer"}),P&&(0,t.jsx)(W,{actionName:"create_customer",navigation:c,formErrors:e==null?void 0:e.customerActionErrors,onCancel:()=>{i(""),e&&(e.customerActionErrors={})}})]}),(0,t.jsxs)(I,{open:F,children:[(0,t.jsx)("h3",{className:"mb-4",children:"Create new product"}),F&&(0,t.jsx)(X,{actionName:"create_product",selectData:{brands:q,types:_,models:V},navigation:c,formErrors:e==null?void 0:e.productActionErrors,onCancel:()=>{w({type:"update",row_id:m,product_id:""}),e&&(e.productActionErrors={})}})]})]})}export{tt as default,ot as meta};
